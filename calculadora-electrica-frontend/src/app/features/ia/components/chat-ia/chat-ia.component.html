<div class="chat-container">
  <div class="chat-header">
    <h2>Chat con Electridom</h2>
    <button class="clear-btn" (click)="clearChat()" [disabled]="messages().length <= 1">
      <i class="fas fa-trash"></i> Limpiar
    </button>
  </div>

  <div class="chat-messages" #messagesContainer>
    @for (message of messages(); track message.id) {
      <div class="message" [class.user-message]="message.isUser" [class.ai-message]="!message.isUser">
        <div class="message-avatar">
          @if (message.isUser) {
            <i class="fas fa-user"></i>
          } @else {
            <i class="fas fa-robot"></i>
          }
        </div>
        <div class="message-content">
          <div class="message-text" [class.streaming]="message.isStreaming">
            {{ message.content }}
            @if (message.isStreaming) {
              <span class="cursor">|</span>
            }
          </div>
          <div class="message-time">
            {{ message.timestamp | date:'shortTime' }}
          </div>
        </div>
      </div>
    }
  </div>

  <div class="chat-input">
    <div class="input-container">
      <textarea
        [value]="currentQuestion()"
        (input)="currentQuestion.set($any($event.target).value)"
        (keypress)="onKeyPress($event)"
        placeholder="Escribe tu pregunta sobre cálculos eléctricos..."
        [disabled]="isLoading()"
        rows="2"
        class="message-input"
      ></textarea>
      <button
        class="send-btn"
        (click)="sendMessage()"
        [disabled]="!canSendMessage()"
        [class.loading]="isLoading()"
      >
        @if (isLoading()) {
          <i class="fas fa-spinner fa-spin"></i>
        } @else {
          <i class="fas fa-paper-plane"></i>
        }
      </button>
    </div>
  </div>
</div>
